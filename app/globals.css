@import 'tailwindcss';

:root {
  /* 主色調 */
  --primary-blue: #ffffff;
  --primary-blue-light: #cccccc;
  --primary-blue-dark: #ffffff;

  /* 輔助顏色 */
  --accent-yellow: #facc15;
  --accent-yellow-light: #fde047;
  --accent-yellow-dark: #eab308;

  /* 背景色（純黑） */
  --background-primary: #000000;
  --background-secondary: #000000;
  --background-tertiary: #111111;

  /* 文字色 */
  --text-primary: #ffffff;
  --text-secondary: #999999;
  --text-tertiary: #666666;

  /* 邊框 */
  --border-color: #222222;

  /* 圓角 */
  --radius-small: 8px;
  --radius-medium: 12px;
  --radius-large: 16px;
  --radius-xl: 20px;

  /* 陰影 */
  --shadow-light: 0 1px 3px rgba(0, 0, 0, 0.5);
  --shadow-medium: 0 4px 12px rgba(0, 0, 0, 0.6);
  --shadow-heavy: 0 8px 24px rgba(0, 0, 0, 0.7);
  --shadow-blue: none;
  --shadow-yellow: none;

  /* 字體 */
  --font-family: var(--font-noto-sans-tc), 'Noto Sans TC', 'Microsoft JhengHei', 'PingFang TC', Arial, sans-serif;

  /* 字體大小 (Perfect Fourth 1.333 ratio, base 16px) */
  --text-xs: 0.75rem;      /* 12px */
  --text-sm: 0.875rem;     /* 14px */
  --text-base: 1rem;       /* 16px */
  --text-lg: 1.125rem;     /* 18px */
  --text-xl: 1.3125rem;    /* 21px */
  --text-2xl: 1.5rem;      /* 24px */
  --text-3xl: 1.75rem;     /* 28px */
  --text-4xl: 2.375rem;    /* 38px */
  --text-5xl: 3.125rem;    /* 50px */
  --text-6xl: 4.1875rem;   /* 67px */

  /* 字重 */
  --font-weight-regular: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 600;
  --font-weight-bold: 700;

  /* 行高 - 語義化 Token */
  --leading-compact: 1.3;   /* 單行元素：按鈕、標籤、徽章 */
  --leading-heading: 1.4;   /* 標題 */
  --leading-caption: 1.625; /* 小字註解 */
  --leading-body: 1.75;     /* 內文段落 */

  /* 字距 - 語義化 Token */
  --tracking-default: 0em;    /* 標準 CJK */
  --tracking-fine: 0.02em;    /* 小字微調 */
  --tracking-ui: 0.06em;      /* UI 元素：按鈕、標籤 */
  --tracking-display: 0.08em; /* 裝飾性標題 */

  /* Dashboard 專用 */

  --status-active: #22c55e;
  --status-paused: #f59e0b;
  --status-completed: #6b7280;
  --status-planned: #8b5cf6;
  --priority-high: #ef4444;
  --priority-medium: #f59e0b;
  --priority-low: #22c55e;
}

body {
  font-family: var(--font-family);
  font-weight: 400;
  color: var(--text-primary);
  background-color: var(--background-secondary);
  line-height: 1.6;
  animation: pageEnter 0.4s ease-out both;
}

@keyframes pageEnter {
  from { opacity: 0; }
  to   { opacity: 1; }
}

body.page-exit {
  transition: opacity 0.5s ease-in;
  opacity: 0;
  pointer-events: none;
}

/* 移除按鈕 focus 外框 */
button:focus-visible {
  outline: none;
}

/* 暗色調表單元素 */
input, select, textarea {
  color: var(--text-primary);
  font-family: inherit;
}

input::placeholder, textarea::placeholder {
  color: var(--text-tertiary);
}

option {
  background-color: var(--background-primary);
  color: var(--text-primary);
}

/* Fade-in 動畫 */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-fade-in {
  animation: fadeIn 0.4s ease-out forwards;
}

.stagger-animation > * {
  opacity: 0;
  animation: fadeIn 0.4s ease-out forwards;
}

.stagger-animation > *:nth-child(1) { animation-delay: 0ms; }
.stagger-animation > *:nth-child(2) { animation-delay: 50ms; }
.stagger-animation > *:nth-child(3) { animation-delay: 100ms; }
.stagger-animation > *:nth-child(4) { animation-delay: 150ms; }
.stagger-animation > *:nth-child(5) { animation-delay: 200ms; }
.stagger-animation > *:nth-child(6) { animation-delay: 250ms; }
.stagger-animation > *:nth-child(7) { animation-delay: 300ms; }
.stagger-animation > *:nth-child(8) { animation-delay: 350ms; }
.stagger-animation > *:nth-child(9) { animation-delay: 400ms; }

/* Spinner 旋轉動畫 */
@keyframes spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

.animate-spin {
  animation: spin 1s linear infinite;
}

/* Port 狀態脈衝動畫 - 啟動中 */
@keyframes port-pulse {
  0%, 100% {
    transform: scale(1);
    opacity: 1;
    box-shadow: 0 0 0 0 rgba(250, 204, 21, 0.7);
  }
  50% {
    transform: scale(1.3);
    opacity: 0.8;
    box-shadow: 0 0 12px 4px rgba(250, 204, 21, 0.5);
  }
}

.animate-port-pulse {
  animation: port-pulse 1s ease-in-out infinite;
}

/* Port 運行中的呼吸發光效果 */
@keyframes port-glow {
  0%, 100% {
    box-shadow: 0 0 8px rgba(110, 231, 183, 0.5);
  }
  50% {
    box-shadow: 0 0 16px rgba(110, 231, 183, 0.8), 0 0 24px rgba(110, 231, 183, 0.4);
  }
}

.animate-port-glow {
  animation: port-glow 2s ease-in-out infinite;
}

/* Memory 警告脈衝（critical 狀態） */
@keyframes memory-warning-pulse {
  0%, 100% {
    border-color: rgba(239, 68, 68, 0.3);
    box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
  }
  50% {
    border-color: rgba(239, 68, 68, 0.7);
    box-shadow: 0 0 8px 2px rgba(239, 68, 68, 0.15);
  }
}

.animate-memory-warning {
  animation: memory-warning-pulse 2s ease-in-out infinite;
}

/* 狀態變化時的縮放動畫 */
@keyframes status-pop {
  0% {
    transform: scale(0.5);
    opacity: 0;
  }
  50% {
    transform: scale(1.4);
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

.animate-status-pop {
  animation: status-pop 0.4s ease-out forwards;
}

/* 自訂滾動條樣式 */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--background-primary);
  border-radius: 8px;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.15);
  border-radius: 8px;
  border: 2px solid var(--background-primary);
  transition: all 0.3s ease;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.25);
}

::-webkit-scrollbar-thumb:active {
  background: rgba(255, 255, 255, 0.35);
}

/* Firefox 滾動條樣式 */
* {
  scrollbar-width: thin;
  scrollbar-color: rgba(255, 255, 255, 0.15) var(--background-primary);
}

/* 面板分隔線 — hover 1 秒漸變關閉效果 */
.divider-handle .divider-bg {
  position: absolute;
  inset: 0;
  opacity: 0;
  pointer-events: none;
}

.divider-handle .divider-line {
  width: 1px;
  border-radius: 9999px;
  background-color: rgba(255,255,255,0.1);
  transition: background-color 1s linear, width 1s linear;
  pointer-events: none;
}

.divider-handle[data-hovering="true"] .divider-bg {
  animation: divider-fill 1s linear forwards;
}

.divider-handle[data-hovering="true"] .divider-line {
  width: 4px;
  background-color: #ffffff;
}

.divider-handle[data-hovering="false"] .divider-bg,
.divider-handle:not([data-hovering]) .divider-bg {
  animation: none;
  opacity: 0;
}

@keyframes divider-fill {
  from { opacity: 0; background-color: rgba(0, 0, 0, 0.7); }
  to   { opacity: 1; background-color: rgba(255, 255, 255, 0.9); }
}

/* 展開長條 hover 填充動畫 */
.expand-handle {
  background-color: rgba(255, 255, 255, 0.08);
}

.expand-handle[data-hovering="true"] {
  animation: expand-fill 400ms linear forwards;
}

.expand-handle[data-hovering="false"],
.expand-handle:not([data-hovering]) {
  animation: none;
  background-color: rgba(255, 255, 255, 0.08);
}

@keyframes expand-fill {
  from { background-color: rgba(255, 255, 255, 0.08); }
  to   { background-color: rgba(255, 255, 255, 0.7); }
}

/* 浮動決策面板進入動畫 */
@keyframes overlay-appear {
  from { opacity: 0; transform: translateY(-8px); }
  to { opacity: 1; transform: translateY(0); }
}

.action-overlay-enter {
  animation: overlay-appear 0.25s ease-out;
}

/* 共用 Shimmer 掃光動畫（左→右） */
@keyframes shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

@keyframes shimmer-breathe {
  0%, 100% { opacity: 0.4; }
  50% { opacity: 1; }
}

.shimmer-text {
  background: linear-gradient(
    90deg,
    #777777 0%,
    #777777 30%,
    #ffffff 50%,
    #777777 70%,
    #777777 100%
  );
  background-size: 200% 100%;
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: shimmer 2.5s ease-in-out infinite;
}

.shimmer-dot {
  animation: shimmer-breathe 3s ease-in-out infinite;
}

/* Streaming per-word 漸入動畫
 * 參考：Vercel Streamdown (150ms fadeIn)、FlowToken (0.5s fadeIn)、reworkd Perplexity (0.75s)
 * rehype-animate plugin 把文字拆成 per-word <span data-animate>，
 * React reconciliation 保持已存在的 span 不變，只有新 mount 的 span 觸發動畫。
 */
@keyframes sd-fadeIn {
  from { opacity: 0; filter: blur(4px); }
  to   { opacity: 1; filter: blur(0); }
}

[data-animate] {
  animation: sd-fadeIn 0.6s ease both;
}

/* 清除對話淡出動畫 */
.chat-clearing {
  opacity: 0;
  transform: translateY(10px);
  transition: opacity 0.25s ease-out, transform 0.25s ease-out;
}

/* 工具操作淡入淡出 */
@keyframes toolCrossfade {
  from { opacity: 0; }
  to { opacity: 1; }
}

.tool-crossfade {
  animation: toolCrossfade 0.3s ease-in-out;
}

.streaming-status-text {
  animation: toolCrossfade 0.3s ease-in-out, shimmer 1.8s ease-in-out infinite;
  background: linear-gradient(
    90deg,
    currentColor 0%,
    currentColor 15%,
    #cccccc 50%,
    currentColor 85%,
    currentColor 100%
  );
  background-size: 200% 100%;
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
}

/* Chat 波浪呼吸圓點 */
@keyframes chat-wave {
  0%, 100% {
    transform: translateY(0);
    opacity: 0.35;
    box-shadow: 0 0 0 transparent;
  }
  50% {
    transform: translateY(-3px);
    opacity: 1;
    box-shadow: 0 0 6px rgba(180, 180, 180, 0.45);
  }
}

.chat-wave-dot {
  width: 5px;
  height: 5px;
  border-radius: 50%;
  background-color: var(--dot-color, var(--text-tertiary));
  animation: chat-wave 2s ease-in-out infinite;
}

/* 速記待辦彈窗進場動畫 */
@keyframes quick-todo-enter {
  from { opacity: 0; transform: scale(0.95) translateY(8px); }
  to { opacity: 1; transform: scale(1) translateY(0); }
}

.quick-todo-modal {
  animation: quick-todo-enter 0.2s ease-out;
}

/* === 右側面板群佈局（純 CSS，不受 GSAP 干擾） === */
.right-panel-group {
  display: grid;
  height: 100%;
  min-width: 0;
  overflow-x: auto;
  flex: 1 1 0%;
  transition: opacity 0.2s ease;
}
.right-panel-group[data-state="hidden"] {
  flex: 0 0 0px;
  width: 0;
  opacity: 0;
  overflow: hidden;
  pointer-events: none;
}

/* Chat 面板格子 */
.chat-panel-cell {
  height: 100%;
  padding: 1rem 1rem 1rem 0.5rem;
  overflow: hidden;
  min-width: 0;
  transition: opacity 0.2s ease;
}
.chat-panel-cell[data-exiting="true"] {
  opacity: 0;
}

/* === Build Panel === */

/* Phase 容器 — 啟動閃光（一次性） */
@keyframes build-ignite {
  0% {
    box-shadow: 0 0 30px 8px rgba(245, 158, 11, 0.15), inset 0 0 20px rgba(245, 158, 11, 0.04);
    border-color: rgba(245, 158, 11, 0.7);
    background-color: rgba(245, 158, 11, 0.04);
  }
  100% {
    box-shadow: 0 0 8px 2px rgba(245, 158, 11, 0.04);
    border-color: rgba(245, 158, 11, 0.35);
    background-color: rgba(245, 158, 11, 0.01);
  }
}

/* Phase 容器 — 持續呼吸 */
@keyframes build-breathe {
  0%, 100% {
    box-shadow: 0 0 6px 1px rgba(245, 158, 11, 0.03);
    border-color: rgba(245, 158, 11, 0.25);
    background-color: rgba(245, 158, 11, 0.005);
  }
  50% {
    box-shadow: 0 0 22px 5px rgba(245, 158, 11, 0.1), inset 0 0 10px rgba(245, 158, 11, 0.02);
    border-color: rgba(245, 158, 11, 0.6);
    background-color: rgba(245, 158, 11, 0.025);
  }
}
.build-phase-running {
  animation: build-ignite 0.6s ease-out, build-breathe 2s ease-in-out 0.6s infinite;
}

/* Step 卡片 — 啟動閃光（一次性） */
@keyframes build-step-ignite {
  0% {
    box-shadow: 0 0 16px 4px rgba(245, 158, 11, 0.12);
    border-color: rgba(245, 158, 11, 0.65);
  }
  100% {
    box-shadow: 0 0 4px 1px rgba(245, 158, 11, 0.04);
    border-color: rgba(245, 158, 11, 0.35);
  }
}

/* Step 卡片 — 持續呼吸 */
@keyframes build-step-breathe {
  0%, 100% {
    box-shadow: 0 0 3px 0 rgba(245, 158, 11, 0.02);
    border-color: rgba(245, 158, 11, 0.3);
  }
  50% {
    box-shadow: 0 0 14px 2px rgba(245, 158, 11, 0.1);
    border-color: rgba(245, 158, 11, 0.65);
  }
}
.build-step-running {
  animation: build-step-ignite 0.4s ease-out, build-step-breathe 1.8s ease-in-out 0.4s infinite;
}

/* Spinner 光暈 */
.build-spinner-glow {
  text-shadow: 0 0 8px rgba(245, 158, 11, 0.6), 0 0 16px rgba(245, 158, 11, 0.3);
}

/* AI output 區 markdown 樣式 */
.build-ai-output p { margin: 0.5em 0; }
.build-ai-output strong { color: var(--text-primary); font-weight: 600; }
.build-ai-output code {
  font-size: 0.875rem;
  padding: 0.15em 0.45em;
  border-radius: 4px;
  background: rgba(255,255,255,0.06);
  color: var(--primary-blue-light);
}
.build-ai-output ul, .build-ai-output ol { padding-left: 1.5em; margin: 0.5em 0; }
.build-ai-output li { margin: 0.3em 0; }
.build-ai-output table { width: 100%; border-collapse: collapse; margin: 0.6em 0; font-size: 0.9375rem; }
.build-ai-output th, .build-ai-output td { padding: 0.6em 1em; border: 1px solid var(--border-color); text-align: left; line-height: 1.7; }
.build-ai-output th { color: var(--text-primary); font-weight: 600; background: rgba(255,255,255,0.03); }

/* ── Team Monitor 動畫 ── */

/* 訊息從左邊滑入 */
@keyframes team-msg-enter {
  from { opacity: 0; transform: translateX(-12px); }
  to { opacity: 1; transform: translateX(0); }
}
.team-msg-enter {
  animation: team-msg-enter 0.4s ease-out forwards;
}

/* 系統事件淡入 */
@keyframes team-system-enter {
  from { opacity: 0; transform: translateY(6px); }
  to { opacity: 1; transform: translateY(0); }
}
.team-system-enter {
  animation: team-system-enter 0.3s ease-out forwards;
}

/* Activity 文字 cross-fade */
@keyframes team-activity-cycle {
  0%, 8% { opacity: 0; transform: translateY(3px); }
  12%, 88% { opacity: 1; transform: translateY(0); }
  92%, 100% { opacity: 0; transform: translateY(-3px); }
}
.team-activity-line {
  animation: team-activity-cycle 2.2s ease-in-out;
}

/* 當 shimmer-text 和 team-activity-line 同時使用時，合併兩個動畫避免覆蓋 */
.shimmer-text.team-activity-line {
  animation: shimmer 2.5s ease-in-out infinite, team-activity-cycle 2.2s ease-in-out;
}

/* Member card working glow（使用 CSS custom property --member-glow） */
@keyframes member-working-glow {
  0%, 100% { box-shadow: inset 2px 0 6px -3px var(--member-glow); }
  50% { box-shadow: inset 2px 0 12px -3px var(--member-glow), 0 0 8px -4px var(--member-glow); }
}
.member-card-working {
  animation: member-working-glow 2.5s ease-in-out infinite;
}
